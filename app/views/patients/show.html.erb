<div class="container dash-page content">

  <div class="row">

    <div class="dash-left col-xs-4">

      <div class="dash-profile">
        <div class="patient-card">
          <div class="avatar-container">
            <%= cl_image_tag(@patient.photo, class: "avatar-md", alt: "#{@patient.first_name} #{@patient.last_name}") %>
          </div>

          <div class="patient-info">
            <p class="patient-name"><%= @patient.first_name %> <%= @patient.last_name %></p>
            <div class="last-row">
              <p class="patient-location smaller"><i class="fas fa-map-marker-alt"></i> <%= @patient.address %></p>
              <p class="patient-data smaller">
                <span><i class="fas fa-id-card"></i> <%= age(@patient.date_birth) %></span>
                <span><i class="fas fa-tint"></i> <%= @patient.pat_blood %></span>
              </p>
            </div>
          </div>
        </div>
      </div>

      <div class="dash-doctors">
        <div class="doctor-head">
          <h3>Doctors</h3>

          <div class="doctor-head-icons">
            <%= link_to doctors_patient_path(@patient), class: "btn btn-default" do %>
              <i class="fas fa-eye"></i>
            <% end %>
            <%= link_to docsearch_patient_path(@patient), class: "btn btn-default" do %>
              <i class="fas fa-plus"></i>
            <% end %>
          </div>
        </div>

        <div class="doctor-list">
          <% @doctors.each do |doctor| %>
            <% rel = DoctorPatient.where(doctor: doctor, patient: @patient, status: 'active').last %>
            <% doctor_name = "#{doctor.first_name} #{doctor.last_name}" %>
            <%= link_to doctors_patient_path(@patient, query: doctor_name) do %>
              <ul>
                <li style="width: 25%">
                  <%= image_tag(doctor.photo, class: "avatar-sm", alt: "#{"Dr. " if doctor.user_type == 'doctor' } #{doctor.first_name} #{doctor.last_name}") %>
                </li>
                <li style="width: 75%">
                  <p class="name">Dr. <%= doctor.first_name %> <%= doctor.last_name %></p>
                  <p><%= doctor.doc_specialties[0] %></p>
                <!-- </li> -->
                <!-- li style="width: 35%">
                  <p class="smaller"><i class="fas fa-map-marker-alt"></i> <%#= doctor.address %></p>
                  <p class="smaller"><i class="far fa-address-book"></i> <%#= rel.updated_at.strftime("%d-%m-%y") %></p>
                </li> -->
              </ul>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>

    <% pat_updates = patientActions(@patient)[:updates] %>
    <% pat_documents = patientActions(@patient)[:documents] %>
    <% pat_exams = patientActions(@patient)[:exams] %>
    <% pat_schedules = patientActions(@patient)[:schedules] %>

    <div class="dash-right col-xs-8">
      <div class="dash-updates">
        <div class="dash-title">

          <div class="dash-title-left">
            <h4>Last Updates</h4>

            <% new_updates = pat_updates.select{ |update| update.read_at.nil? }.count %>
            <% if new_updates.positive? %>
              <h4 class="news"><%= new_updates %></h4>
            <% end %>
          </div>

          <div class="dash-title-right">
              <% if pat_updates.count.positive? %>
                <%= link_to patient_updates_path(@patient), class: "btn btn-default" do %>
                  <i class="fas fa-eye"></i>
                <% end %>
              <% end %>
          </div>
        </div>

        <div class="dash-table">
          <% pat_updates.take(5).each do |update| %>
            <div class="top-5">
              <%= link_to patient_updates_path(@patient, query: update.topic.title) do %>
                <ul style="width: 100%; min-width: 100%;">
                  <li style="width: 12%">
                    <%= image_tag(update.user.photo, class: "avatar-sm", alt: "#{"Dr. " if update.user.user_type == 'doctor' } #{update.user.first_name} #{update.user.last_name}") %>
                  </li>
                  <li style="width: 13%"><%= "Dr." if update.user.user_type == 'doctor' %> <%= update.user.first_name %> <%= update.user.last_name %>
                  </li>
                  <li style="width: 25%"><%= update.topic.title %></li>
                  <li style="width: 20%"><%= update.topic_status.capitalize %></li>
                  <li style="width: 20%"><%= update.created_at.strftime('%d-%m-%y') %></li>
                  <li style="width: 5%">
                    <% if update.read_by.nil? %>
                      <i class="fas fa-exclamation-circle fa-lg"></i>
                    <% end %>
                  </li>
                </ul>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>

      <div class="dash-exams">
        <div class="dash-title">

          <div class="dash-title-left">
            <h4>Last Exams</h4>

            <% new_exams = pat_exams.select{ |doc| doc.read_at.nil? }.count %>
            <% if new_exams.positive? %>
              <h4 class="news"><%= new_exams %></h4>
            <% end %>
          </div>

          <div class="dash-title-right">
            <% if pat_updates.count.positive? %>
              <%= link_to patient_documents_path(@patient), class: "btn btn-default" do %>
                <i class="fas fa-eye"></i>
              <% end %>
            <% end %>
          </div>
        </div>

        <div class="dash-table">
          <% pat_exams.take(5).each do |exam| %>
            <div class="top-5">
              <%= link_to patient_documents_path(@patient, query: exam.doc_title) do %>
                <ul style="width: 100%; min-width: 100%;">
                  <li style="width: 12%">
                    <%= image_tag(exam.user.photo, class: "avatar-sm", alt: "#{"Dr. " if exam.user.user_type == 'doctor' } #{exam.user.first_name} #{exam.user.last_name}") %>
                  </li>
                  <li style="width: 13%"><%= "Dr." if exam.user.user_type == 'doctor' %> <%= exam.user.first_name %> <%= exam.user.last_name %>
                  </li>
                  <li style="width: 35%"><%= exam.doc_title %></li>
                  <li style="width: 15%"><%= exam.exam_type %></li>
                  <li style="width: 20%"><%= exam.created_at.strftime('%d-%m-%y') %></li>
                  <li style="width: 5%">
                    <% if exam.read_by.nil? %>
                      <i class="fas fa-exclamation-circle fa-lg"></i>
                    <% end %>
                  </li>
                </ul>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>

      <div class="dash-documents">
        <div class="dash-title">

          <div class="dash-title-left">
            <h4>Last Documents</h4>

            <% new_documents = pat_documents.select{ |doc| doc.read_at.nil? }.count %>
            <% if new_documents.positive? %>
              <h4 class="news"><%= new_documents %></h4>
            <% end %>
          </div>

          <div class="dash-title-right">
            <%= link_to patient_documents_path(@patient), class: "btn btn-default" do %>
              <i class="fas fa-eye"></i>
            <% end %>
          </div>
        </div>

        <div class="dash-table">
          <% pat_documents.take(5).each do |doc| %>
            <div class="top-5">
              <%= link_to patient_documents_path(@patient, query: doc.doc_title) do %>
                <ul style="width: 100%; min-width: 100%;">
                  <li style="width: 12%">
                    <%= image_tag(doc.user.photo, class: "avatar-sm", alt: "#{"Dr. " if doc.user.user_type == 'doctor' } #{doc.user.first_name} #{doc.user.last_name}") %>
                  </li>
                  <li style="width: 13%"><%= "Dr." if doc.user.user_type == 'doctor' %> <%= doc.user.first_name %> <%= doc.user.last_name %>
                  </li>
                  <li style="width: 35%"><%= doc.doc_title %></li>
                  <li style="width: 15%"><%= doc.doc_type %></li>
                  <li style="width: 20%"><%= doc.created_at.strftime('%d-%m-%y') %></li>
                  <li style="width: 5%">
                    <% if doc.read_by.nil? %>
                      <i class="fas fa-exclamation-circle fa-lg"></i>
                    <% end %>
                  </li>
                </ul>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>

      <div class="dash-schedules">
        <div class="dash-title">

          <div class="dash-title-left">
            <h4>Last Schedules</h4>

            <% new_schedules = pat_schedules.select{ |sc| sc.read_at.nil? }.count %>
            <% if new_schedules.positive? %>
              <h4 class="news"><%= new_schedules %></h4>
            <% end %>
          </div>

          <div class="dash-title-right">
            <%= link_to patient_schedules_path(@patient), class: "btn btn-default" do %>
              <i class="fas fa-eye"></i>
            <% end %>
          </div>
        </div>

        <div class="dash-table">
          <% pat_schedules.take(5).each do |sc| %>
            <div class="top-5">
              <%= link_to patient_schedules_path(@patient, query: sc.sc_title) do %>
                <ul style="width: 100%; min-width: 100%;">
                  <li style="width: 12%">
                    <%= image_tag(sc.user.photo, class: "avatar-sm", alt: "#{"Dr. " if sc.user.user_type == 'doctor' } #{sc.user.first_name} #{sc.user.last_name}") %>
                  </li>
                  <li style="width: 13%"><%= "Dr." if sc.user.user_type == 'doctor' %> <%= sc.user.first_name %> <%= sc.user.last_name %>
                  </li>
                  <li style="width: 35%"><%= sc.sc_title %></li>
                  <li style="width: 15%"><%= sc.sc_type %></li>
                  <li style="width: 20%"><%= sc.created_at.strftime('%d-%m-%y') %></li>
                  <li style="width: 5%">
                    <% if sc.read_by.nil? %>
                      <i class="fas fa-exclamation-circle fa-lg"></i>
                    <% end %>
                  </li>
                </ul>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
